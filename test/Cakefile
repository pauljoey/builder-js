
#####################################################################
# Required Builder setup
#####################################################################

#builder   = require '../src/lib/builder' # Local
builder   = require 'builder'             # Global
target    = builder.target
project   = builder.project

option('-t', '--target [TARGET]', 'Target to build (default: "build").');

task 'build', 'Build Project', (options) ->
	options.target = 'build' unless options.target? 
	try
		target = builder.lastProject().getTarget(options.target)
		unless target?
			builder.error "No target named '#{options.target}'"	
		else
			target.build()
	catch err
		unless err.nice_error? and err.nice_error
			throw err
#####################################################################




test = project('builder', 
	build_dir: './=build'
	staging_dir: './=staging'
	source_dir: './src'
)

all = target 'All', ['js/app.js.min']

coffee_files = builder.ls(test.source_dir + '/coffee/*.coffee')


target 'js/app.js.min', ['app.coffee'], ->
	@read()
	@coffee2js()
	@write('js/app.js') # For debugging! :)
	@minify()
	@prepend('*/')
	@prependFile('LICENSE')
	@prepend('/*')
	@write()
	

target 'app.coffee', coffee_files, ->
	@read()
	@cat()
	@writeTmp()
	


